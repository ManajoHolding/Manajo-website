document.addEventListener('DOMContentLoaded', () => {
    // Mobile Menu Toggle
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const navLinks = document.querySelector('.nav-links');

    if (mobileBtn) {
        mobileBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });
    }

    // Smooth Scroll for Anchor Links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
                // Close mobile menu if open
                if (navLinks.classList.contains('active')) {
                    navLinks.classList.remove('active');
                }
            }
        });
    });

    // CAPTCHA Logic
    let captchaAnswer = 0;

    function generateCaptcha() {
        const num1 = Math.floor(Math.random() * 10) + 1;
        const num2 = Math.floor(Math.random() * 10) + 1;
        const operations = ['+', '-', '×'];
        const operation = operations[Math.floor(Math.random() * operations.length)];

        let question = '';

        switch (operation) {
            case '+':
                captchaAnswer = num1 + num2;
                question = `${num1} + ${num2} = ?`;
                break;
            case '-':
                // Ensure positive result
                const larger = Math.max(num1, num2);
                const smaller = Math.min(num1, num2);
                captchaAnswer = larger - smaller;
                question = `${larger} - ${smaller} = ?`;
                break;
            case '×':
                captchaAnswer = num1 * num2;
                question = `${num1} × ${num2} = ?`;
                break;
        }

        const questionElement = document.getElementById('captcha-question');
        if (questionElement) {
            questionElement.textContent = question;
        }
    }

    // Generate CAPTCHA on page load
    generateCaptcha();

    // Form Validation with CAPTCHA
    const contactForm = document.querySelector('.contact-form');
    if (contactForm) {
        contactForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const userAnswer = parseInt(document.getElementById('captcha').value);

            if (userAnswer === captchaAnswer) {
                // CAPTCHA correct - in production, submit the form
                alert('Bedankt voor je bericht! We nemen zo snel mogelijk contact met je op.');
                contactForm.reset();
                generateCaptcha(); // Generate new CAPTCHA
            } else {
                // CAPTCHA incorrect
                alert('Onjuist antwoord op de veiligheidscontrole. Probeer het opnieuw.');
                document.getElementById('captcha').value = '';
                document.getElementById('captcha').focus();
                generateCaptcha(); // Generate new CAPTCHA
            }
        });
    }
    // Logo Carousel Logic
    const carousels = document.querySelectorAll('.logo-carousel-container');

    carousels.forEach(container => {
        const carousel = container.querySelector('.logo-carousel');
        const prevBtn = container.querySelector('.prev-btn');
        const nextBtn = container.querySelector('.next-btn');
        let scrollAmount = 0;
        let autoScrollInterval;

        // Calculate scroll step: item width (150px) + gap (32px) = 182px
        // Or dynamically fetch
        const getStep = () => {
            const item = carousel.querySelector('.logo-item');
            if (item) {
                // width + gap (approx)
                return item.offsetWidth + 32;
            }
            return 182;
        };

        const scrollNext = () => {
            const step = getStep();
            // If we are near the end, loop back (smoothly or jump)
            // For simple infinite feel without cloning: check scrollLeft
            if (carousel.scrollLeft + carousel.offsetWidth >= carousel.scrollWidth - 10) {
                carousel.scrollTo({ left: 0, behavior: 'smooth' });
            } else {
                carousel.scrollBy({ left: step, behavior: 'smooth' });
            }
        };

        const scrollPrev = () => {
            const step = getStep();
            if (carousel.scrollLeft <= 10) {
                carousel.scrollTo({ left: carousel.scrollWidth, behavior: 'smooth' });
            } else {
                carousel.scrollBy({ left: -step, behavior: 'smooth' });
            }
        };

        if (nextBtn) nextBtn.addEventListener('click', () => {
            scrollNext();
            resetAutoScroll();
        });

        if (prevBtn) prevBtn.addEventListener('click', () => {
            scrollPrev();
            resetAutoScroll();
        });

        // Auto Scroll
        const startAutoScroll = () => {
            autoScrollInterval = setInterval(scrollNext, 3000); // 3 seconds
        };

        const stopAutoScroll = () => {
            clearInterval(autoScrollInterval);
        };

        const resetAutoScroll = () => {
            stopAutoScroll();
            startAutoScroll();
        };

        // Pause on hover
        container.addEventListener('mouseenter', stopAutoScroll);
        container.addEventListener('mouseleave', startAutoScroll);

        // Start
        startAutoScroll();
    });
});
